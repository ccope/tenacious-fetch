{"version":3,"file":"tenacious-fetch.m.js","sources":["../src/retrying-fetch.js","../src/backoff.js","../src/index.js"],"sourcesContent":["import {linear, exponential} from './backoff'\n\nexport default function retryingFetch (retries, url, config) {\n  return new Promise((resolve, reject) => {\n    function fetchAttempt (url, config, retriesLeft) {\n      let {retryStatus, fetcher} = config\n      fetcher(url, config)\n        .then(res => {\n          if (retryStatus.includes(res.status)) {\n            if (retriesLeft > 0) {\n              retriesLeft--\n              setTimeout(() => fetchAttempt(url, config, retriesLeft), getRetryDelay(config, retriesLeft))\n            } else {\n              reject(res)\n            }\n          } else {\n            resolve(res)\n          }\n        })\n        .catch(error => {\n          if (retriesLeft > 0) {\n            retriesLeft--\n            setTimeout(() => fetchAttempt(url, config, retriesLeft), getRetryDelay(config, retriesLeft))\n          } else {\n            reject(error)\n          }\n        })\n    }\n\n    fetchAttempt(url, config, retries)\n  })\n}\n\nfunction getRetryDelay ({retryDelay, factor, retries}, retriesLeft) {\n  if (factor && typeof factor === 'number' && Number.isInteger(factor)) {\n    return exponential(factor, retries - retriesLeft)\n  }\n  return linear(retryDelay, retries - retriesLeft)\n}\n","export function linear (initialVal, attempt) {\n  return initialVal * attempt\n}\n\nexport function exponential (factor, attempt) {\n  return Math.pow(factor, attempt)\n}\n","import retryingFetch from './retrying-fetch'\n\nlet browserFetch = false\n\ntry {\n  browserFetch = window && window.fetch\n} catch (error) {}\n\nfunction tenaciousFetch (url = '', config = {}) {\n  config = Object.assign({\n    retries: 1,\n    retryDelay: 1000,\n    retryStatus: [],\n    fetcher: browserFetch,\n    timeout: undefined\n  }, config)\n\n  if (!config.fetcher || typeof config.fetcher !== 'function') {\n    throw new Error(\n      'tenacious-fetch: No fetch implementation found. Provide a valid fetch implementation via the fetcher configuration property.'\n    )\n  }\n\n  if (typeof config.retryStatus === 'string' || typeof config.retryStatus === 'number') {\n    config.retryStatus = [Number.parseInt(config.retryStatus)]\n  }\n\n  const timeout = config.timeout\n\n  if (timeout && Number.isInteger(timeout)) {\n    return Promise.race([\n      retryingFetch(config.retries, url, config),\n      new Promise((resolve, reject) =>\n        setTimeout(\n          () =>\n            reject(\n              new Error(\n                `tenacious-fetch: Request took longer than timeout of ${timeout} ms.`\n              )\n            ),\n          timeout\n        )\n      )\n    ])\n  }\n\n  return retryingFetch(config.retries, url, config)\n}\n\nexport default tenaciousFetch\n"],"names":["retryingFetch","retries","url","config","Promise","resolve","reject","fetchAttempt","retriesLeft","retryStatus","fetcher","then","res","includes","status","setTimeout","getRetryDelay","catch","error","ref","retryDelay","factor","Number","isInteger","attempt","Math","pow","exponential","let","browserFetch","window","fetch","Object","assign","timeout","undefined","Error","parseInt","const","race"],"mappings":"AAEe,SAASA,EAAeC,EAASC,EAAKC,GACnD,OAAO,IAAIC,iBAASC,EAASC,IAC3B,SAASC,EAAcL,EAAKC,EAAQK,GAClC,IAAKC,iBACLC,aAAQR,EAAKC,GACVQ,cAAKC,GACAH,EAAYI,SAASD,EAAIE,QACvBN,EAAc,GAChBA,IACAO,6BAAiBR,EAAaL,EAAKC,EAAQK,IAAcQ,EAAcb,EAAQK,KAE/EF,EAAOM,GAGTP,EAAQO,KAGXK,eAAMC,GACDV,EAAc,GAChBA,IACAO,6BAAiBR,EAAaL,EAAKC,EAAQK,IAAcQ,EAAcb,EAAQK,KAE/EF,EAAOY,KAKfX,CAAaL,EAAKC,EAAQF,KAI9B,SAASe,EAAeG,EAA+BX,OAA9BY,eAAYC,WAAQpB,YAC3C,OAAIoB,GAA4B,iBAAXA,GAAuBC,OAAOC,UAAUF,GC9B/D,SAA6BA,EAAQG,GACnC,OAAOC,KAAKC,IAAIL,EAAQG,GD8BfG,CAAYN,EAAQpB,EAAUO,GAEzBY,GAAYnB,EAAUO,GEnCtCoB,IAAIC,GAAe,EAEnB,IACEA,EAAeC,QAAUA,OAAOC,YACzBb,mBAET,SAAyBhB,EAAUC,GASjC,kBAT6B,yBAC7BA,EAAS6B,OAAOC,QACdhC,QAAS,EACTmB,WAAY,IACZX,eACAC,QAASmB,EACTK,aAASC,GACRhC,IAESO,SAAqC,mBAAnBP,EAAOO,QACnC,MAAM,IAAI0B,MACR,gIAI8B,iBAAvBjC,EAAOM,aAA0D,iBAAvBN,EAAOM,cAC1DN,EAAOM,aAAea,OAAOe,SAASlC,EAAOM,eAG/C6B,IAAMJ,EAAU/B,EAAO+B,QAEvB,OAAIA,GAAWZ,OAAOC,UAAUW,GACvB9B,QAAQmC,MACbvC,EAAcG,EAAOF,QAASC,EAAKC,GACnC,IAAIC,iBAASC,EAASC,UACpBS,6BAEIT,EACE,IAAI8B,8DACsDF,YAG9DA,OAMDlC,EAAcG,EAAOF,QAASC,EAAKC"}