{"version":3,"file":"tenacious-fetch.js","sources":["../node_modules/abortcontroller-polyfill/dist/abortcontroller-polyfill-only.js","../src/retrying-fetch.js","../src/index.js"],"sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  (factory());\n}(this, (function () { 'use strict';\n\n  var classCallCheck = function (instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  };\n\n  var createClass = function () {\n    function defineProperties(target, props) {\n      for (var i = 0; i < props.length; i++) {\n        var descriptor = props[i];\n        descriptor.enumerable = descriptor.enumerable || false;\n        descriptor.configurable = true;\n        if (\"value\" in descriptor) descriptor.writable = true;\n        Object.defineProperty(target, descriptor.key, descriptor);\n      }\n    }\n\n    return function (Constructor, protoProps, staticProps) {\n      if (protoProps) defineProperties(Constructor.prototype, protoProps);\n      if (staticProps) defineProperties(Constructor, staticProps);\n      return Constructor;\n    };\n  }();\n\n  var get = function get(object, property, receiver) {\n    if (object === null) object = Function.prototype;\n    var desc = Object.getOwnPropertyDescriptor(object, property);\n\n    if (desc === undefined) {\n      var parent = Object.getPrototypeOf(object);\n\n      if (parent === null) {\n        return undefined;\n      } else {\n        return get(parent, property, receiver);\n      }\n    } else if (\"value\" in desc) {\n      return desc.value;\n    } else {\n      var getter = desc.get;\n\n      if (getter === undefined) {\n        return undefined;\n      }\n\n      return getter.call(receiver);\n    }\n  };\n\n  var inherits = function (subClass, superClass) {\n    if (typeof superClass !== \"function\" && superClass !== null) {\n      throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  };\n\n  var possibleConstructorReturn = function (self, call) {\n    if (!self) {\n      throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    }\n\n    return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n  };\n\n  var Emitter = function () {\n    function Emitter() {\n      classCallCheck(this, Emitter);\n\n      this.listeners = {};\n    }\n\n    createClass(Emitter, [{\n      key: 'addEventListener',\n      value: function addEventListener(type, callback) {\n        if (!(type in this.listeners)) {\n          this.listeners[type] = [];\n        }\n        this.listeners[type].push(callback);\n      }\n    }, {\n      key: 'removeEventListener',\n      value: function removeEventListener(type, callback) {\n        if (!(type in this.listeners)) {\n          return;\n        }\n        var stack = this.listeners[type];\n        for (var i = 0, l = stack.length; i < l; i++) {\n          if (stack[i] === callback) {\n            stack.splice(i, 1);\n            return;\n          }\n        }\n      }\n    }, {\n      key: 'dispatchEvent',\n      value: function dispatchEvent(event) {\n        var _this = this;\n\n        if (!(event.type in this.listeners)) {\n          return;\n        }\n        var debounce = function debounce(callback) {\n          setTimeout(function () {\n            return callback.call(_this, event);\n          });\n        };\n        var stack = this.listeners[event.type];\n        for (var i = 0, l = stack.length; i < l; i++) {\n          debounce(stack[i]);\n        }\n        return !event.defaultPrevented;\n      }\n    }]);\n    return Emitter;\n  }();\n\n  var AbortSignal = function (_Emitter) {\n    inherits(AbortSignal, _Emitter);\n\n    function AbortSignal() {\n      classCallCheck(this, AbortSignal);\n\n      var _this2 = possibleConstructorReturn(this, (AbortSignal.__proto__ || Object.getPrototypeOf(AbortSignal)).call(this));\n\n      _this2.aborted = false;\n      _this2.onabort = null;\n      return _this2;\n    }\n\n    createClass(AbortSignal, [{\n      key: 'toString',\n      value: function toString() {\n        return '[object AbortSignal]';\n      }\n    }, {\n      key: 'dispatchEvent',\n      value: function dispatchEvent(event) {\n        if (event.type === 'abort') {\n          this.aborted = true;\n          if (typeof this.onabort === 'function') {\n            this.onabort.call(this, event);\n          }\n        }\n\n        get(AbortSignal.prototype.__proto__ || Object.getPrototypeOf(AbortSignal.prototype), 'dispatchEvent', this).call(this, event);\n      }\n    }]);\n    return AbortSignal;\n  }(Emitter);\n\n  var AbortController = function () {\n    function AbortController() {\n      classCallCheck(this, AbortController);\n\n      this.signal = new AbortSignal();\n    }\n\n    createClass(AbortController, [{\n      key: 'abort',\n      value: function abort() {\n        var event = void 0;\n        try {\n          event = new Event('abort');\n        } catch (e) {\n          if (typeof document !== 'undefined') {\n            // For Internet Explorer 11:\n            event = document.createEvent('Event');\n            event.initEvent('abort', false, false);\n          } else {\n            // Fallback where document isn't available:\n            event = {\n              type: 'abort',\n              bubbles: false,\n              cancelable: false\n            };\n          }\n        }\n        this.signal.dispatchEvent(event);\n      }\n    }, {\n      key: 'toString',\n      value: function toString() {\n        return '[object AbortController]';\n      }\n    }]);\n    return AbortController;\n  }();\n\n  if (typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n    // These are necessary to make sure that we get correct output for:\n    // Object.prototype.toString.call(new AbortController())\n    AbortController.prototype[Symbol.toStringTag] = 'AbortController';\n    AbortSignal.prototype[Symbol.toStringTag] = 'AbortSignal';\n  }\n\n  function hasBrokenNativeAbortController(userAgent) {\n    if (userAgent.match(/ (crios|gsa|fxios)\\//i)) {\n      return true;\n    }\n    if (userAgent.match(/ Safari\\//i) && userAgent.match(/ Version\\/(12.0|12.1|11)/i)) {\n      return true;\n    }\n    return false;\n  }\n\n  function nativeAbortControllerIsBroken(self) {\n    return self.navigator && self.navigator.userAgent && hasBrokenNativeAbortController(self.navigator.userAgent);\n  }\n\n  (function (self) {\n\n    if (self.AbortController && !nativeAbortControllerIsBroken(self)) {\n      return;\n    }\n\n    self.AbortController = AbortController;\n    self.AbortSignal = AbortSignal;\n  })(typeof self !== 'undefined' ? self : global);\n\n})));\n","/* global AbortController */\nimport {linear, exponential} from './backoff'\nimport 'abortcontroller-polyfill/dist/abortcontroller-polyfill-only'\nconst pRetry = require('p-retry');\n\nfunction retryingFetch(retries, url, config, start_time = 0) {\n  return pRetry(\n    (attempt) => {\n      if (config.abortTimeout || config.totalTimeLimit) {\n         return timeoutRetryPromise(url, config, start_time);\n      } else {\n         return fetchAttempt(url, config);\n    }},\n    {\n      onFailedAttempt: config.onFailedAttempt,\n      retries: config.retries,\n      factor: config.factor,\n      minTimeout: config.retryMinDelay,\n      maxTimeout: config.retryMaxDelay\n  })\n}\n\nfunction timeoutRetryPromise(url, config, start_time) {\n  var abortTimer;\n  var controller;\n  return Promise.race([\n    new Promise((resolve, reject) => {\n      controller = new AbortController();\n      config.signal = controller.signal;\n      if (config.totalTimeLimit && performance.now() - start_time > config.totalTimeLimit) {\n        if (abortTimer) { clearTimer(abortTimer) }\n          reject(new pRetry.AbortError(new pRetry.AbortError('Total Time Limit Exceeded')))\n      };\n      resolve();\n    })\n    .then(res => { return fetchAttempt(url, config) }),\n    new Promise((resolve, reject) =>\n      abortTimer = setTimeout(() => {\n        controller.abort();;\n        },\n        config.abortTimeout || config.totalTimeLimit)\n    )\n  ])\n}\n\nfunction fetchAttempt(url, config) {\n  return new Promise((resolve, reject) => {\n    config.fetcher(url, config)\n      .then(res => {\n        if (config.retryStatus.includes(res.status)) {\n            let err = new Error(res.statusText)\n            reject(err)\n        }\n        resolve(res)\n      })\n      .catch(e => reject(e))\n  })\n}\n\nexport default retryingFetch\n","if (window && window.fetch && ('signal' in new window.Request(''))) {\n  const browserFetch = window.fetch\n} else if (window) {\n  const browserFetch = require('whatwg-fetch')\n} else {\n  const browserFetch = require('node-fetch')\n}\nimport retryingFetch from './retrying-fetch'\n\n\nasync function tenaciousFetch(url = '', config = {}) {\n\n  config = Object.assign({\n    factor: 1,\n    retries: 0,\n    retryDelay: undefined,\n    retryMinDelay: 1000,\n    retryMaxDelay: Infinity,\n    retryStatus: [],\n    fetcher: browserFetch,\n    abortTimeout: undefined,\n    totalTimeLimit: undefined\n  }, config)\n\n  if (!config.fetcher || typeof config.fetcher !== 'function') {\n    throw new Error(\n      'tenacious-fetch: No fetch implementation found. Provide a valid fetch implementation via the fetcher configuration property.'\n    )\n  }\n\n  if (typeof config.onFailedAttempt != 'function') {\n    config.onFailedAttempt = () => {}\n  }\n  if (typeof config.retryStatus === 'string' || typeof config.retryStatus === 'number') {\n    config.retryStatus = [Number.parseInt(config.retryStatus)]\n  }\n  if (config.retryDelay) {\n    config.retryMinDelay = config.retryDelay\n    delete config.retryDelay\n  }\n\n  const start_time = performance.now()\n  return retryingFetch(config.retries, url, config, start_time)\n}\nexport default tenaciousFetch\n"],"names":["classCallCheck","createClass","possibleConstructorReturn","AbortSignal","AbortController","instance","Constructor","TypeError","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","self","call","ReferenceError","_Emitter","this","_this2","__proto__","getPrototypeOf","aborted","onabort","subClass","superClass","create","constructor","value","setPrototypeOf","inherits","event","type","get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","undefined","parent","getter","Emitter","listeners","callback","push","stack","l","splice","_this","debounce","setTimeout","defaultPrevented","signal","Event","e","document","createEvent","initEvent","bubbles","cancelable","dispatchEvent","Symbol","toStringTag","navigator","userAgent","match","nativeAbortControllerIsBroken","global","pRetry","require","retryingFetch","retries","url","config","start_time","attempt","abortTimeout","totalTimeLimit","abortTimer","controller","Promise","race","resolve","reject","performance","now","clearTimer","AbortError","then","res","fetchAttempt","abort","timeoutRetryPromise","onFailedAttempt","factor","minTimeout","retryMinDelay","maxTimeout","retryMaxDelay","fetcher","retryStatus","includes","status","let","err","Error","statusText","catch","window","fetch","Request","assign","retryDelay","Infinity","browserFetch","Number","parseInt","const"],"mappings":"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"}